@startuml
' Группировка по слоям
package "Сущности (Entity)" {
    class Пользователь {
        +Идентификатор : Guid
        +Имя : string
        +Роль : string
        +Почта : string
        +ХэшПароля : string
    }
    class Билет {
        +Идентификатор : Guid
        +РасписаниеId : Guid
        +МестоId : Guid
        +Статус : string
        +Цена : decimal
        +ДатаСоздания : DateTime
        +ДатаИзменения : DateTime
        +СозданПользователем : Guid
    }
    class Место {
        +Идентификатор : Guid
        +ЗалId : Guid
        +НомерРяда : int
        +НомерМеста : int
        +Категория : string
    }
    class Расписание {
        +Идентификатор : Guid
        +СпектакльId : Guid
        +ЗалId : Guid
        +ВремяНачала : DateTime
        +БазоваяЦена : decimal
    }
    class Спектакль {
        +Идентификатор : Guid
        +Название : string
        +Описание : string
        +ДлительностьМинут : int
    }
    class Зал {
        +Идентификатор : Guid
        +Название : string
        +Вместимость : int
    }
}

package "Граница (Boundary)" {
    class СтраницаВыбораМеста {
        +ПоказатьМеста()
        +ПриКликеНаМесто()
        +ПриПокупкеБилета()
    }
    class МодельВыбораМеста {
        +Места : ObservableCollection<МестоViewModel>
        +ВыбранноеМесто : МестоViewModel
        +КомандаПродажиБилета
        +КомандаБронирования
        +Инициализировать(расписаниеId)
    }
}

package "Контроллер (Control)" {
    class СервисSupabase {
        +ПолучитьМеста(залId)
        +ПолучитьБилеты(расписаниеId)
        +СоздатьБилет(билет)
        +УдалитьБилет(билетId)
        +ПолучитьДеталиРасписания(расписаниеId)
    }
    class СервисНавигации {
        +ПерейтиНаСтраницу(страница, параметры)
        +Назад()
    }
    class СервисАвторизации {
        +ТекущийПользователь
        +Войти()
        +Выйти()
    }
}

' Связи между слоями
СтраницаВыбораМеста -right-> МодельВыбораМеста : MVVM
МодельВыбораМеста -right-> СервисSupabase : использует
МодельВыбораМеста -right-> СервисНавигации : использует
МодельВыбораМеста -right-> СервисАвторизации : использует

МодельВыбораМеста -down-> Место : отображает
МодельВыбораМеста -down-> Билет : создаёт/читает
МодельВыбораМеста -down-> Расписание : читает
МодельВыбораМеста -down-> Пользователь : использует для СозданПользователем

СервисSupabase -down-> Билет : управляет
СервисSupabase -down-> Место : управляет
СервисSupabase -down-> Расписание : управляет
СервисSupabase -down-> Пользователь : управляет

Билет -down-> Место
Билет -down-> Расписание
Билет -down-> Пользователь : СозданПользователем

Расписание -down-> Спектакль
Расписание -down-> Зал

Место -down-> Зал

@enduml